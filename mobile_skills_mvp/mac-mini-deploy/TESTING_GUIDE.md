# ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—

## ğŸ§ª æµ‹è¯•ç›®æ ‡

éªŒè¯å¤šæœåŠ¡å™¨æ”¯æŒå’Œæ•…éšœè½¬ç§»åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå·²å°±ç»ªï¼š

- âœ… Mac miniï¼šOpenCode Server + ngrok è¿è¡Œ
- âœ… Windows PCï¼šOpenCode Server + ngrok è¿è¡Œï¼ˆå¤‡ç”¨ï¼‰
- âœ… Android æ‰‹æœºï¼šå·²å®‰è£…æœ€æ–°ç‰ˆ APK
- âœ… ç½‘ç»œï¼šæ‰‹æœºå¯ä»¥è®¿é—®å…¬ç½‘

### 2. é…ç½®æœåŠ¡å™¨

ç¼–è¾‘ `src/services/servers.config.ts`ï¼š

```typescript
export const DEFAULT_SERVERS: ServerConfig[] = [
  {
    name: 'Mac Mini',
    url: 'https://your-mac-mini.ngrok-free.dev',
    priority: 1,
    enabled: true,
  },
  {
    name: 'Windows PC',
    url: 'https://your-windows-pc.ngrok-free.dev',
    priority: 2,
    enabled: true,
  },
];
```

### 3. æ„å»ºå¹¶å®‰è£… APK

```bash
cd mobile_skills_mvp

# æ‰“åŒ… JS bundle
npx react-native bundle --platform android --dev false \
  --entry-file index.ts \
  --bundle-output android/app/src/main/assets/index.android.bundle

# æ„å»º APK
cd android && ./gradlew assembleDebug

# å®‰è£…åˆ°æ‰‹æœº
adb install -r android/app/build/outputs/apk/debug/app-debug.apk
```

## âœ… æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1: æ­£å¸¸è¿æ¥ï¼ˆMac Mini ä¼˜å…ˆï¼‰

**ç›®æ ‡**: éªŒè¯åº”ç”¨è‡ªåŠ¨è¿æ¥åˆ°ä¼˜å…ˆçº§æœ€é«˜çš„æœåŠ¡å™¨

**æ­¥éª¤**:
1. ç¡®ä¿ Mac mini å’Œ Windows PC éƒ½åœ¨è¿è¡Œ
2. æ‰“å¼€ç§»åŠ¨ç«¯åº”ç”¨
3. è§‚å¯Ÿè¿æ¥çŠ¶æ€

**é¢„æœŸç»“æœ**:
```
âœ“ è¿æ¥çŠ¶æ€ï¼šå·²è¿æ¥ (Mac Mini)
âœ“ æœåŠ¡å™¨åœ°å€ï¼šMac mini çš„ ngrok URL
âœ“ å¯ä»¥æ­£å¸¸å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
```

**æ—¥å¿—éªŒè¯**:
```bash
adb logcat | grep -E "ServerManager|ChatScreen"

# é¢„æœŸè¾“å‡ºï¼š
# [ServerManager] Selected server: Mac Mini
# [ChatScreen] Selected server: Mac Mini https://xxx.ngrok-free.dev
# [ChatScreen] Connection successful!
```

---

### æµ‹è¯• 2: æ•…éšœè½¬ç§»åˆ° Windows PC

**ç›®æ ‡**: éªŒè¯ä¸»æœåŠ¡å™¨æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨

**æ­¥éª¤**:
1. åº”ç”¨æ­£å¸¸è¿æ¥åˆ° Mac mini
2. åœæ­¢ Mac mini çš„ OpenCode Serverï¼š
   ```bash
   ./mac-mini-deploy/stop-opencode.sh
   ```
3. å…³é—­å¹¶é‡æ–°æ‰“å¼€åº”ç”¨
4. è§‚å¯Ÿè¿æ¥çŠ¶æ€

**é¢„æœŸç»“æœ**:
```
âœ“ è¿æ¥çŠ¶æ€ï¼šå·²è¿æ¥ (Windows PC)
âœ“ æœåŠ¡å™¨åœ°å€ï¼šWindows PC çš„ ngrok URL
âœ“ è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨
```

**æ—¥å¿—éªŒè¯**:
```bash
adb logcat | grep -E "ServerManager|ChatScreen"

# é¢„æœŸè¾“å‡ºï¼š
# [ServerManager] Attempting to recover server: Mac Mini
# [ServerManager] Selected server: Windows PC
```

---

### æµ‹è¯• 3: æœåŠ¡å™¨æ¢å¤åè‡ªåŠ¨åˆ‡æ¢å›ä¸»æœåŠ¡å™¨

**ç›®æ ‡**: éªŒè¯ä¸»æœåŠ¡å™¨æ¢å¤åè‡ªåŠ¨åˆ‡å›

**æ­¥éª¤**:
1. åº”ç”¨è¿æ¥åˆ° Windows PCï¼ˆMac mini å·²åœæ­¢ï¼‰
2. å¯åŠ¨ Mac mini çš„ OpenCode Serverï¼š
   ```bash
   ./mac-mini-deploy/start-opencode.sh
   ./mac-mini-deploy/start-ngrok.sh
   ```
3. å…³é—­å¹¶é‡æ–°æ‰“å¼€åº”ç”¨
4. è§‚å¯Ÿè¿æ¥çŠ¶æ€

**é¢„æœŸç»“æœ**:
```
âœ“ è¿æ¥çŠ¶æ€ï¼šå·²è¿æ¥ (Mac Mini)
âœ“ è‡ªåŠ¨åˆ‡æ¢å›ä¸»æœåŠ¡å™¨
```

---

### æµ‹è¯• 4: æ‰€æœ‰æœåŠ¡å™¨ä¸å¯ç”¨

**ç›®æ ‡**: éªŒè¯æ‰€æœ‰æœåŠ¡å™¨ä¸å¯ç”¨æ—¶çš„é”™è¯¯å¤„ç†

**æ­¥éª¤**:
1. åœæ­¢ Mac mini å’Œ Windows PC çš„ OpenCode Server
2. æ‰“å¼€åº”ç”¨

**é¢„æœŸç»“æœ**:
```
âœ“ æ˜¾ç¤ºè¿æ¥å¤±è´¥æç¤º
âœ“ æä¾›é‡è¯•é€‰é¡¹
âœ“ æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤º"æœªè¿æ¥"
```

**UI éªŒè¯**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿æ¥å¤±è´¥               â”‚
â”‚                         â”‚
â”‚ æ²¡æœ‰å¯ç”¨çš„æœåŠ¡å™¨ã€‚        â”‚
â”‚ è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–         â”‚
â”‚ æœåŠ¡å™¨é…ç½®ã€‚             â”‚
â”‚                         â”‚
â”‚ [å–æ¶ˆ] [è®¾ç½®] [é‡è¯•]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æµ‹è¯• 5: ç¦ç”¨ç‰¹å®šæœåŠ¡å™¨

**ç›®æ ‡**: éªŒè¯å¯ä»¥é€šè¿‡é…ç½®ç¦ç”¨æœåŠ¡å™¨

**æ­¥éª¤**:
1. ç¼–è¾‘ `servers.config.ts`ï¼Œç¦ç”¨ Mac miniï¼š
   ```typescript
   {
     name: 'Mac Mini',
     url: 'https://xxx.ngrok-free.dev',
     priority: 1,
     enabled: false, // ç¦ç”¨
   }
   ```
2. é‡æ–°æ„å»ºå¹¶å®‰è£… APK
3. æ‰“å¼€åº”ç”¨

**é¢„æœŸç»“æœ**:
```
âœ“ ç›´æ¥è¿æ¥åˆ° Windows PCï¼ˆè·³è¿‡ Mac miniï¼‰
âœ“ ä¸å°è¯•è¿æ¥è¢«ç¦ç”¨çš„æœåŠ¡å™¨
```

---

### æµ‹è¯• 6: æœåŠ¡å™¨å¥åº·æ£€æŸ¥

**ç›®æ ‡**: éªŒè¯å¥åº·æ£€æŸ¥åŠŸèƒ½

**æ­¥éª¤**:
1. åœ¨åº”ç”¨ä¸­æ‰“å¼€å¼€å‘è€…é€‰é¡¹ï¼ˆå¦‚æœå¯ç”¨ï¼‰
2. è§¦å‘å¥åº·æ£€æŸ¥
3. è§‚å¯Ÿæ—¥å¿—

**é¢„æœŸç»“æœ**:
```bash
# å¥åº·çš„æœåŠ¡å™¨
[ServerManager] Running health check...
[Service] Health: true

# ä¸å¥åº·çš„æœåŠ¡å™¨
[ServerManager] Server Mac Mini marked as unavailable after 3 failures
```

---

### æµ‹è¯• 7: é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§

**ç›®æ ‡**: éªŒè¯é•¿æ—¶é—´è¿è¡Œçš„ç¨³å®šæ€§

**æ­¥éª¤**:
1. åº”ç”¨è¿æ¥åˆ° Mac mini
2. ä¿æŒåº”ç”¨è¿è¡Œ 1 å°æ—¶
3. å®šæœŸå‘é€æ¶ˆæ¯ï¼ˆæ¯ 10 åˆ†é’Ÿï¼‰
4. è§‚å¯Ÿæ˜¯å¦æœ‰è¿æ¥æ–­å¼€

**é¢„æœŸç»“æœ**:
```
âœ“ æ‰€æœ‰æ¶ˆæ¯éƒ½èƒ½æˆåŠŸå‘é€
âœ“ æ²¡æœ‰è¿æ¥ä¸­æ–­
âœ“ æ²¡æœ‰å†…å­˜æ³„æ¼
```

---

## ğŸ“Š æµ‹è¯•è®°å½•è¡¨

| æµ‹è¯•ç”¨ä¾‹ | çŠ¶æ€ | ç»“æœ | å¤‡æ³¨ |
|---------|------|------|------|
| æµ‹è¯•1: æ­£å¸¸è¿æ¥ | â¬œ | â˜ Pass â˜ Fail | |
| æµ‹è¯•2: æ•…éšœè½¬ç§» | â¬œ | â˜ Pass â˜ Fail | |
| æµ‹è¯•3: æ¢å¤åˆ‡æ¢ | â¬œ | â˜ Pass â˜ Fail | |
| æµ‹è¯•4: å…¨éƒ¨ä¸å¯ç”¨ | â¬œ | â˜ Pass â˜ Fail | |
| æµ‹è¯•5: ç¦ç”¨æœåŠ¡å™¨ | â¬œ | â˜ Pass â˜ Fail | |
| æµ‹è¯•6: å¥åº·æ£€æŸ¥ | â¬œ | â˜ Pass â˜ Fail | |
| æµ‹è¯•7: é•¿æ—¶é—´è¿è¡Œ | â¬œ | â˜ Pass â˜ Fail | |

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# æ¸…ç©ºæ—¥å¿—
adb logcat -c

# ç›‘æ§åº”ç”¨æ—¥å¿—
adb logcat ReactNativeJS:V *:S

# ç›‘æ§ç‰¹å®šå…³é”®è¯
adb logcat | grep -E "ServerManager|ChatScreen|OpenCode"
```

### æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€

```bash
# Mac mini
curl https://your-mac-mini.ngrok-free.dev/global/health

# Windows PC
curl https://your-windows-pc.ngrok-free.dev/global/health
```

### æ¨¡æ‹Ÿç½‘ç»œæ•…éšœ

```bash
# åœæ­¢ ngrokï¼ˆæ¨¡æ‹Ÿç½‘ç»œä¸­æ–­ï¼‰
kill $(cat ~/ngrok.pid)

# é‡å¯ ngrok
./mac-mini-deploy/start-ngrok.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: åº”ç”¨æ— æ³•è¿æ¥åˆ°ä»»ä½•æœåŠ¡å™¨

**æ£€æŸ¥**:
1. ç¡®è®¤ OpenCode Server æ­£åœ¨è¿è¡Œ
2. ç¡®è®¤ ngrok éš§é“å·²å»ºç«‹
3. åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­æµ‹è¯• ngrok URL
4. æ£€æŸ¥æ‰‹æœºç½‘ç»œè¿æ¥

**è§£å†³**:
- é‡å¯ OpenCode Server
- é‡å¯ ngrok
- é‡æ–°æ„å»º APK

### Q2: åº”ç”¨è¿æ¥åˆ°é”™è¯¯çš„æœåŠ¡å™¨

**æ£€æŸ¥**:
1. æŸ¥çœ‹æœåŠ¡å™¨é…ç½®ä¼˜å…ˆçº§
2. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤é€‰æ‹©é€»è¾‘

**è§£å†³**:
- è°ƒæ•´ priority å€¼
- é‡æ–°æ„å»º APK

### Q3: æ•…éšœè½¬ç§»ä¸å·¥ä½œ

**æ£€æŸ¥**:
1. æŸ¥çœ‹ ServerManager æ—¥å¿—
2. ç¡®è®¤å¤±è´¥æ¬¡æ•°é˜ˆå€¼ï¼ˆmaxFailuresï¼‰

**è§£å†³**:
- å¢åŠ æ—¥å¿—è¯¦ç»†ç¨‹åº¦
- è°ƒæ•´ maxFailures å‚æ•°

---

## âœ… æµ‹è¯•å®Œæˆæ ‡å‡†

æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡åï¼š

- âœ… ä»£ç å·²æäº¤åˆ° Git
- âœ… Mac mini éƒ¨ç½²æ–‡æ¡£å·²æ›´æ–°
- âœ… æµ‹è¯•ç»“æœå·²è®°å½•
- âœ… å·²å‡†å¤‡å¥½ç”Ÿäº§éƒ¨ç½²

---

**æµ‹è¯•å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ªå¯é çš„ 24å°æ—¶è¿è¡Œçš„ OpenCode Serverï¼** ğŸ‰
